From 0c8c7bcfe6a18f02f84fd33d8f4ec4f57809106f Mon Sep 17 00:00:00 2001
From: Thomas Guillem <thomas@gllm.fr>
Date: Thu, 22 Aug 2019 10:54:34 +0200
Subject: [PATCH 1/5] preparser: art: add missing alloc check

(cherry picked from commit 2949b6580193a162cbcd536927e828d7fa3a7847)
---
 src/playlist/art.c | 12 ++++++++++++
 1 file changed, 12 insertions(+)

diff --git a/src/playlist/art.c b/src/playlist/art.c
index 53133e5598..09874386ed 100644
--- a/src/playlist/art.c
+++ b/src/playlist/art.c
@@ -67,8 +67,20 @@ static char* ArtCacheGetDirPath( const char *psz_arturl, const char *psz_artist,
     if( !EMPTY_STR(psz_artist) && !EMPTY_STR(psz_album) )
     {
         char *psz_album_sanitized = strdup( psz_album );
+        if (!psz_album_sanitized)
+        {
+            free( psz_cachedir );
+            return NULL;
+        }
         filename_sanitize( psz_album_sanitized );
+
         char *psz_artist_sanitized = strdup( psz_artist );
+        if (!psz_artist_sanitized)
+        {
+            free( psz_cachedir );
+            free( psz_album_sanitized );
+            return NULL;
+        }
         filename_sanitize( psz_artist_sanitized );
         if( asprintf( &psz_dir, "%s" DIR_SEP "art" DIR_SEP "artistalbum"
                       DIR_SEP "%s" DIR_SEP "%s", psz_cachedir,
-- 
2.20.1

